---
title: TML - React 프로젝트에서 accessToken & refreshToken 사용하기
date: '2023-09-11'
tags: ['tml']
draft: false
summary: 'axios 라이브러리 인터셉터 설정으로 토큰 사용하기'
---

# accessToken & refreshToken
- 인증 및 권한 부여 시스템에서 사용된다.

## 📌 accessToken (액세스 토큰):
- 짧은 수명을 가진 토큰 (액세스 토큰의 수명을 짧게 유지하면 액세스 토큰 탈취를 방지하는 보안상의 이점을 얻을 수 있다.)
- 서버의 특정 리소스에 액세스 가능

## 📌 refreshToken (리프레시 토큰):
- 짧은 액세스 토큰을 새로 발급받기 위한 토큰 
- 일반적으로 액세스 토큰보다 긴 수명을 가진다.
- 액세스 토큰이 만료되면 리프레시 토큰을 사용해 새 액세스 토큰을 발급

<br/>

## 클라이언트 동작 과정
1. 클라이언트에서 로그인을 하면 서버는 액세스 토큰과 리프레시 토큰 두 가지를 반환
2. 클라이언트에서 각 토큰을 저장하여 서버 api 리소스 서비스를 이용
3. 액세스 토큰이 만료되면, 클라이언트에 저장했던 리프레시 토큰을 가지고 새로운 액세스 토큰을 요청

## 저장 
1. LocalStorage or SessionStorage
- 웹페이지를 새로 고칠 때나 브라우저를 다시 시작할 때 토큰 정보가 유지
- XSS(크로스 사이트 스크립팅) 공격의 위험이 있다.
- 악의적인 스크립트가 실행되면, 해당 스크립트가 LocalStorage에 접근할 위험이 있다.

2. Cookie:
- HTTP Only 속성을 적용하면 JS에서 Cookie에 접근할 수 없기 때문에 XSS 공격에서 비교적 안전
- CSRF(크로스 사이트 요청 위조) 공격의 위험성
- React 자체에는 쿠키를 다루는 내장 메서드가 없으므로 js-cookie와 같은 라이브러리를 사용 필요

3. 상태 관리 도구
- Context API, Redux 등

<br/><br/>

# 프로젝트에 적용하기
1. 다양한 방법이 있지만 이번 포스트에서는 localStorage에 저장해 보려고 한다.
![](https://velog.velcdn.com/images/mintmin0320/post/605edecd-9481-4acc-8ed7-a2e8c0b5878a/image.png)

2. 액세스 토큰으로 API 리소스를 도중 액세스 토큰이 만료되면 리프레시 토큰을 사용하도록 코드를 구현할 필요가 있다. 위 사진처럼 api 요청 컴포넌트에 적용해도 되지만, 공통으로 사용할 기능이기 때문에 index.js에서 공통으로 처리하는 코드를 작상하고자 한다.
![](https://velog.velcdn.com/images/mintmin0320/post/f1863da5-00b0-48b8-a6ed-6d37978c04c7/image.png)
액세스 토큰 만료 전까지는 정상적으로 헤더에 토큰을 포함시켜 보낸다. 만료됐을 경우 서버에서 401에러를 반환하게 되고 이 경우 localStorage에 저장된 리프레시 토큰을 헤더에 포함시켜 요청을 보내게 된다.

<br/>

>  HTTP(하이퍼텍스트 전송 프로토콜) 401 Unauthorized 응답 상태 코드는 요청된 리소스에 대한 유효한 인증 자격 증명이 없기 때문에 클라이언트 요청이 완료되지 않았음을 나타냅니다.

<br/>

### 💡 axios 인터셉터
- axios를 사용하여 HTTP 요청 또는 응답을 전송하기 전, 또는 받기 전에 실행되는 함수 이를 통해 HTTP 요청/응답을 가로채서 어떠한 처리를 할 수 있다.

<br/><br/>

## 마무리 🔚
이번에 axios 인터셉터를 처음 사용해보게 되었는데, 역시 공통으로 처리할 수 있는 방법이 편리하다는 사실을 다시금 깨달았다. 이제 액세스 토큰과 리프레시 토큰을 어떤 방식으로 저장할지 충분한 학습과 고민이 필요할 것 같다. 프로젝트 발표가 끝나긴 했지만, 코드 상태도 지저분하고 완성을 목표로 급하게 제작했기 때문에 포기하거나 부족했던 기능 구현도 많았다. 당분간은 그동안 놓쳤던 부분을 정비하며 다시 앞으로 나아가고자 한다! 🔥



<br/><br/>