---
title: '[TML] - FormData를 사용해 이미지 파일과 데이터 전송하기'
date: '2023-07-14'
tags: ['TML']
draft: false
summary: 'FomData 사용해 서버로 이미지 파일과 데이터 전송하기'
---

비가 많이 오는 기념으로 오랜만에 포스팅을 해볼까 한다. 현재 진행 중인 프로젝트에서 공유 오피스를 등록할 때 회의실 이미지와 각종 데이터들을 서버에 전송하는 데 사용할 FormData 사용법에 대해 포스팅해 보겠다.

<br/>

<회의실 등록 페이지>
![](https://velog.velcdn.com/images/mintmin0320/post/603474c4-d447-4523-9160-cd50a1eb8380/image.png)회의실 등록에 필요한 데이터를 잠시 살펴보자.
>회의실 이름
>자치구(지역)
>회의실 상세주소
>회의실 전화번호
>회의실 이미지
>대여료(무료/유료)
>회의실 부가설명

회의실 이미지를 제외하고는 모두 input으로 입력받은 데이터를 활용하고 이미지의 경우는 파일의 형태로 전송해주면 된다. 파일 형태로 데이터를 전송하기 위해서는 FormData를 사용해야 한다!

<br/>

### FormData
![](https://velog.velcdn.com/images/mintmin0320/post/126cc4a4-0e5d-48f8-ae49-3a2a8ca62ff6/image.png)

```
const formData = new FormData();
```

- JS에서 HTML5의 form 태그 역할을 수행 -> JS 스크립트도 전송 가능하다.
- 내장객체(window.FormData)이므로 따로 설치 없이 사용이 가능하다.
- "KEY-VALUE" 구조로 데이터를 전송한다.


>FormData와 form은 다르다!
form은 HTML5에서 사용하는 태그이고,
FormData는 JS에서 form 단위를 사용하는 객체다.
>
즉, HTML5에서 form 태그로 데이터를 전송하는 역할을 JS에서는 FormData로 사용이 가능하다.



아래 코드 로직은 회의실을 등록하는데 필요한 데이터들을 FormData에 추가하고 추가된 데이터들을 form 태그에서 onSubmit 이벤트를 통해 서버로 전달하는 방식으로 사용됐다.

![](https://velog.velcdn.com/images/mintmin0320/post/614daca9-3450-41d0-ab50-1feb63f33e83/image.png)form 태그 안에는 데이터를 입력하는 input들이 배치되어 있다. 등록 완료 버튼을 클릭하면 form 태그에 데이터들이 FormData를 통해 서버로 전송된다.

우선 주요 코드를 보며 한 파트씩 살펴보겠다.
![](https://velog.velcdn.com/images/mintmin0320/post/3983cca3-3a3a-49df-9063-f88c1964aea2/image.png)

![](https://velog.velcdn.com/images/mintmin0320/post/4d5052fe-86f8-4c22-a682-c1dc5968a16e/image.png)

> useState의 경우 state라는 객체 안에 상태 변수를 추가했다.
- 객체이므로 state.pay와 같이 사용하면 된다.
- state 선언을 여러 줄 선언하면 가독성이 좀 떨어지는 것 같아서 사용해 봤다.
- areaName만 초기값을 설정한 이유는 select 태그를 사용할 때 default로 용산구가 설정되어 있기 때문이다.

![](https://velog.velcdn.com/images/mintmin0320/post/b3aef91a-69d7-4d42-8a7a-1eebc71784da/image.png)
 해당 함수는 아래 사진을 보시면 이해가 잘 될 것 같다.

![](https://velog.velcdn.com/images/mintmin0320/post/63eb30bd-321b-4d11-b430-f385ebe8a7fa/image.png)파일 선택을 클릭하고 이미지를 선택하면 

![](https://velog.velcdn.com/images/mintmin0320/post/67b580d9-aba4-4525-b438-317d9ea245d5/image.png)onChange를 통해 선택된 이미지가 e(event)에 담겨 handleImgUpload(e) 함수에 전달되고 코드가 실행된다.

이어서 handleImgUpload 함수를 설명하면,
![](https://velog.velcdn.com/images/mintmin0320/post/8af050f5-203e-4283-85d2-74b99bb5d4ce/image.png)

- 이미지는 e.target.files에 위치한 상태이고, 한 장의 이미지만 전송하므로 e.target.files[0]에 이미지 파일이 담겨있다.
- setState({ })는 객체로 선언한 useState에 [state, setState]에서 state 값을 변경시키는 방법이다. 
const [file, setFile] = useState("")로 대체하셔도 무방히다.
해당 함수가 실행되면 file이라는 state 변수에는 현재 이미지 파일이 담겨있는 상태다.

>
+ console.log(e.target.files[0])의 값
![](https://velog.velcdn.com/images/mintmin0320/post/16b5862d-da0c-49ef-9572-34e9d48ec4f5/image.png)

form 태그에서 실행되는 함수 handleOnSubmit을 살펴보겠다.
![](https://velog.velcdn.com/images/mintmin0320/post/3983cca3-3a3a-49df-9063-f88c1964aea2/image.png)

- e.preventDefault는 form 태그가 전송되면 자동으로 화면 새로고침 현상이 발생하는데, 이 경우 서버에 데이터 전송이 되기 전에 화면이 새로고침 되어 요청을 보내지 못하게 된다. 해당 코드를 사용하면 새로고침 되는 e(event)발생을 중지시키는 역할을 수행한다.
- form 태그의 주요 메서드 (formData는 아까 new FormData로 생성했다.)
>formData.append(key, value) - key, value를 추가
formData.delete(key) - key에 해당하는 key, value 삭제
formData.get(key) - key 값에 해당하는 value 반환
formData.has(key) - key 값이 존재하면 true, 아니면 false
formData.getAll(key) - append 메서드로 추가 시 key 중복을 허용한다, 모든 key 값에 해당하는 value 반환
>
(작성하고 보니 Map과 유사한 것 같다. 👀)

- formData에 값이 잘 저장됐는지 확인하려고 console.log(formData)를 사용하면 원하는 정보가 출력되지 않는다. 그래서 for...of를 사용해 주시면 된다.
![](https://velog.velcdn.com/images/mintmin0320/post/218b712f-f7b9-4dd1-844f-6be5f4eb7499/image.png)

```
    //Key 확인하기
    for (let key of formData.keys()) {
      console.log("key : " + key);
    }

    /* value 확인하기 */
    for (let value of formData.values()) {
      console.log("value : " + value);
    }
```

- 서버와의 요청, 응답 과정에서 발생할 에러를 대비해 try...catch를 사용했고, formData를 통채로 서버에 전송했다. (이미 key, value 형태로 다 설정했다.)
![](https://velog.velcdn.com/images/mintmin0320/post/67b094b6-d3e7-4478-96c5-1a815e1d985d/image.png)

## 🚀 서버로 요청
등록하기 버튼을 클릭하면 아까 for...of로 formData를 출력했던 값, 서버에서 성공적으로 응답했다는 메시지, 프론트에서 응답 결과 성공이면 출력되는 '성공' 메세지가 출력된 것을 확인할 수 있다!
(👀이미지는 위 console 결과에서 본 것처럼 object File의 형태다.)
![](https://velog.velcdn.com/images/mintmin0320/post/0cf7af23-a381-447b-8025-f510ff29bb77/image.png)

회의실 리스트에도 정상적으로 추가가 됐다.
![](https://velog.velcdn.com/images/mintmin0320/post/4035466a-44ea-4a23-865b-5c3677ac0206/image.png)

<br/>

## 후기
최근 강의와 과제 위주로 학습을 진행하느라 블로그를 너무 방치한 것 같아 향후 어떻게 블로그를 운영할지 고민을 많이 해봤는데, 기존처럼 학습 내용은 노션으로 정리하고 도움이 될 것 같은 내용들이나 구글에 검색했을 때 자료가 부족하다고 느낀 부분을 포스팅하기로 결정했다. 글이 너무 많으면 유익한 자료 일지라도 가독성도 떨어지고 이해하기 어려웠던 경험이 있어 최대한 도표, 이미지를 적극 활용해 포스팅을 이어나갈 예정이다.