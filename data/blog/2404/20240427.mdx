---
title: 'Nextì™€ ErrorBoundary - with. React Query'
date: '2024-04-27'
tags: ['React', 'Next']
draft: false
summary: 'Error Boundaryë¥¼ ì§ì ‘ êµ¬í˜„í•˜ê³  React Query(v5)ì™€ í•¨ê»˜ í”„ë¡œì íŠ¸ì— ì ìš©í•˜ê¸°'
images: ['/static/images/thumbnail/confirm.webp']
---

<center>

> - [ì´ì „ ê²Œì‹œë¬¼: React ì—ëŸ¬ í•¸ë“¤ë§ì„ í•´ë³´ì - ErrorBoundary](https://mintmin.dev/blog/2312/20231212)

</center>

<br />

ì´ì „ ê²Œì‹œë¬¼ ë‚´ìš©ì— ì´ì–´ ì´ë²ˆì—ëŠ” **Next.js** í”„ë¡œì íŠ¸ì—ì„œ **Error Boundaries**ë¥¼ ì ìš©í•´ ë³´ê³ ì í•œë‹¤. **React**ì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µë˜ëŠ” **Suspense**ì™€ëŠ” ë‹¤ë¥´ê²Œ **Error Boundaries** ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ë‹¨ìˆœí•˜ê²Œ importê°€ ì•„ë‹Œ **ì§ì ‘ êµ¬í˜„**ì´ í•„ìš”í•˜ë‹¤.

<hr />

<center>

![](https://velog.velcdn.com/images/mintmin0320/post/6747463c-5570-4fe1-b78c-59a7b67c829e/image.png)

</center>

<hr />

í•œ ê°€ì§€ íŠ¹ì´í•œ ì ì´ ìˆë‹¤ë©´, êµ¬í˜„ ê³¼ì •ì—ì„œ **ì—ëŸ¬ ë°œìƒ ì‹œ ê°€ì¥ ì—ëŸ¬ ìºì¹˜ ë°‘ í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ì˜ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸**í•˜ëŠ” ì¤‘ìš”í•œ ì—­í• ì„ ìˆ˜í–‰í•˜ëŠ” `getDerivedStateFromError` **ìƒëª… ì£¼ê¸° ë©”ì„œë“œ**ê°€ **ì•„ì§ Hookìœ¼ë¡œ êµ¬í˜„ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì—** ë¶€ë“ì´í•˜ê²Œë„ **Class ì»´í¬ë„ŒíŠ¸ë¡œ êµ¬í˜„**ì´ í•„ìš”í•˜ë‹¤.

<center>

![](https://velog.velcdn.com/images/mintmin0320/post/b1af3669-422b-4377-9f2e-48f2ce0877a5/image.png)

#### ì•Œëœ°ì‚´ëœ°í•˜ê²Œ 32.8 KBë¥¼ ì•„ê»´ë³´ì

</center>

<br />

ì´ì „ ê²Œì‹œë¬¼ì—ì„œëŠ” [react-error-boundary ë¼ì´ë¸ŒëŸ¬ë¦¬](https://www.npmjs.com/package/react-error-boundary)ë¥¼ ì‚¬ìš©í•´ ë”°ë¡œ êµ¬í˜„í•˜ì§€ ì•Šê³  ì‚¬ìš©í–ˆëŠ”ë°, ì´ë²ˆì— ì¶”ê°€ì ìœ¼ë¡œ í•™ìŠµì„ ì§„í–‰í•´ ë³´ë©° ë”°ë¡œ êµ¬í˜„í•  ë§Œí¼ ë³µì¡í•˜ì§€ ì•Šê³  ì»¤ìŠ¤í…€ ì—¬ë¶€ë¥¼ ìƒê°í–ˆì„ ë•Œ êµ³ì´ ë¶ˆí•„ìš”í•˜ê²Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤ëŠ” ëŠë‚Œì´ ë“¤ì—ˆë‹¤. ë”°ë¼ì„œ ì§ì ‘ **ErrorBoundary** ì»´í¬ë„ŒíŠ¸ë¥¼ ì œì‘í•  ê³„íšì´ë‹¤.

<br />
<hr />

<center>

## í”„ë¡œì íŠ¸ í™˜ê²½

- `Next14 - app Router`
- `tanstack/react-query v5`
- `tailwind CSS`

</center>

<br />
<hr />

ë³¸ê²©ì ìœ¼ë¡œ **Error Boundaries**ë¥¼ êµ¬í˜„í•˜ê¸° ì „ì— **Next í”„ë ˆì„ì›Œí¬**ì—ì„œëŠ” `page.js`, `layout.js`, `error.js`ì™€ ê°™ì€ íŒŒì¼ë“¤ì´ íŠ¹ìˆ˜í•œ ì—­í• ê³¼ ë™ì‘ì„ ìˆ˜í–‰í•˜ê²Œ ëœë‹¤.

<center>

![](https://velog.velcdn.com/images/mintmin0320/post/0a80510f-f9c7-42ea-b085-8e8fc0d097ef/image.png)

</center>

ì²˜ìŒ ë™ì‘ ì´ë¯¸ì§€ë¥¼ ë´¤ì„ ë•Œ `error.js` íŒŒì¼ì„ ìƒì„±í•˜ê³  **ErrorBoundary** ì»´í¬ë„ŒíŠ¸ë¡œ ë˜í•‘ í•˜ë©´ ë™ì‘í•˜ëŠ” ì¤„ ì•Œì•˜ì§€ë§Œ, ì•Œê³  ë³´ë‹ˆ `error.js` íŒŒì¼ë§Œ ìƒì„±í•´ë„ ê³„ì¸µì— ë§ê²Œ ìë™ìœ¼ë¡œ `fallback`ì´ ë™ì‘í•œë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆë‹¤. ì•„ë§ˆë„ ìœ„ ì´ë¯¸ì§€ì—ì„œëŠ” `fallback`ì— **Error(error.js)** ì»´í¬ë„ŒíŠ¸ë¥¼ ë°°ì¹˜í•œ ê²ƒì²˜ëŸ¼ ë™ì‘í•œë‹¤ëŠ” ê²ƒì„ ë³´ì—¬ì£¼ëŠ” ê²ƒ ê°™ë‹¤.

ë§Œì•½ **React Query**ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ë‹¤ë©´, `error.js`ë¥¼ ì‚¬ìš©í•´ ê°„ë‹¨í•œ êµ¬í˜„ì´ ê°€ëŠ¥í•˜ê² ì§€ë§Œ **React Query**ë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ ì‘ì€ ë¬¸ì œê°€ í•˜ë‚˜ ë°œìƒí•˜ê²Œ ëœë‹¤. **buttonì— onClick ì´ë²¤íŠ¸ë¥¼ ì‚¬ìš©í•´ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨(reset) í•  ë•Œ, ìƒˆë¡œê³ ì¹¨ì€ ë™ì‘í•˜ì§€ë§Œ ë‹¤ì‹œ ë°ì´í„°ê°€ ê°±ì‹ ë˜ì§€ ì•ŠëŠ”ë‹¤.**

![](https://velog.velcdn.com/images/mintmin0320/post/19b57ab3-9025-4227-b13c-022df99a28dc/image.gif)

ì´ ì›ì¸ì€ ë°”ë¡œ **React Queryê°€ ê¸°ë³¸ì ìœ¼ë¡œ ìºì‹œ ëœ ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ì— ìœ ì§€í•˜ê³ , ì»´í¬ë„ŒíŠ¸ì˜ ë§ˆìš´íŠ¸ ìƒíƒœì™€ ë…ë¦½ì ìœ¼ë¡œ ì‘ë™í•˜ê¸° ë•Œë¬¸ì´ë‹¤.** ë‹¤í–‰íˆë„ ì´ë¯¸ **React Query ê³µì‹ ë¬¸ì„œ**ì—ì„œ í•´ê²° ë°©ë²•ì„ ì œì‹œí•´ ì£¼ê³  ìˆë‹¤.

í¬ê²Œ [QueryErrorResetBoundary](https://tanstack.com/query/latest/docs/framework/react/reference/QueryErrorResetBoundary) ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ê³¼ [useQueryErrorResetBoundary](https://tanstack.com/query/latest/docs/framework/react/reference/useQueryErrorResetBoundary) í›…ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ ì¡´ì¬í•˜ê³  ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œëŠ” **ì„ ì–¸ì ìœ¼ë¡œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬**í•œë‹¤ëŠ” ê´€ì ì—ì„œ `QueryErrorResetBoundary`ë¥¼ ì‚¬ìš©í•  ê³„íšì´ë‹¤.

<br />
<hr />

<center>

![](https://velog.velcdn.com/images/mintmin0320/post/be2739eb-87a1-4836-98a5-1c442d153003/image.png)

### Next í”„ë ˆì„ì›Œí¬ì—ëŠ” ì´ë¯¸ ErrorBoundaryê°€ êµ¬í˜„ë˜ì–´ ìˆë‹¤??

</center>

<br />

êµ¬í˜„ì— ì•ì„œ, í¥ë¯¸ë¡œìš´ íŒŒì¼ì„ ë°œê²¬í•˜ê²Œ ë˜ì—ˆë‹¤. ì•ì„œ ì–¸ê¸‰í–ˆë“¯ì´ **Error Boundaries**ëŠ” ì§ì ‘ êµ¬í˜„ì´ í•„ìš”í•˜ë‹¤. ê·¸ëŸ°ë° ìš°ì—°íˆ ë§Œë“¤ì–´ ë‘” ì»¤ìŠ¤í…€ **ErrorBoundary** ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ë ¤ë˜ ì¤‘, ì•Œ ìˆ˜ ì—†ëŠ” ê²½ë¡œì˜ **ErrorBoundary**ë¥¼ ë°œê²¬í•˜ê²Œ ëë‹¤.

<center>

![](https://velog.velcdn.com/images/mintmin0320/post/d80a6ec4-df89-42de-8a53-7d3a91dd30a5/image.png)

#### next/dist/client/components/error-boundary??

<br />

</center>

í˜¸ê¸°ì‹¬ì´ ìƒê²¨ ë°”ë¡œ **ê¸°ì¡´ ì»¤ìŠ¤í…€ ErrorBoundary**ë¥¼ ëŒ€ì²´í•´ ì‚¬ìš©í•´ ë´¤ë‹¤. **ê²°ê³¼ëŠ” ë†€ëê²Œë„ ì •ìƒ ë™ì‘í•œë‹¤.** ê²½ë¡œë¥¼ íƒ€ê³  ì½”ë“œë¥¼ ì‚´í´ë³´ë‹ˆ, ì—¬ì „íˆ **Class ì»´í¬ë„ŒíŠ¸** í˜•íƒœë¡œ êµ¬í˜„ì´ ë˜ì–´ìˆì—ˆë‹¤.

ê·¸ë ‡ë‹¤ë©´ ì´ë¯¸ êµ¬í˜„ë˜ì–´ ìˆëŠ” **ErrorBoundary**ë¥¼ ì‚¬ìš©í•˜ë©´ ì¢‹ê² ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆì§€ë§Œ, í•œí¸ìœ¼ë¡œ **í˜¸ì¶œí•˜ëŠ” ê²½ë¡œ**ë¥¼ ë³´ê³  ì°œì°œí•œ ê°ì •ì„ ëŠê¼ˆë‹¤.

<br />

<center>

### ğŸš¨ ì—¬ê¸°ì„œë¶€í„°ëŠ” ì£¼ê´€ì ì¸ ì˜ê²¬ì´ ë‹¤ìˆ˜ í¬í•¨ë  ì˜ˆì •ì´ë‹¤. ğŸš¨

![](https://velog.velcdn.com/images/mintmin0320/post/c3144133-a8c9-405c-871a-4ed3ccc4442a/image.png)

</center>

ë‹¨ì„œë¥¼ ì°¾ê¸° ìœ„í•´ ê²½ë¡œì— ìœ„ì¹˜í•œ ë‹¤ë¥¸ íŒŒì¼ë“¤ì„ ì‚´í´ë³´ì•˜ë‹¤. ê·¸ë¦¬ê³  ëª‡ ê°œì˜ íŒŒì¼ëª…ì„ ë³´ê³  ë‚˜ë¦„ëŒ€ë¡œ `ErrorBoundary` ì¡´ì¬ì˜ ì´ìœ ë¥¼ ìœ ì¶”í•´ ë³´ì•˜ë‹¤.

<br />

| ê²½ë¡œ ë‚´ì— íŒŒì¼ëª…  | ì¶”ì¸¡í•˜ëŠ” ì—­í•  |
| :---------------: | :-----------: |
| error-boundary.\* |   error.js    |
|     layout.\*     |   layout.js   |
|   not-found.\*    | not-found.js  |

`error-boundary.js` íŒŒì¼ ë‚´ë¶€ì—ëŠ” `ErrorBoundaryHandler` í´ë˜ìŠ¤ê°€ ì¡´ì¬í•˜ê³  ê¸°ì¡´ **ErrorBoundary** ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°ì™€ í° ì°¨ì´ê°€ ì—†ì—ˆë‹¤. ì´ë¥¼ í†µí•´ `error.js` ì»´í¬ë„ŒíŠ¸ì˜ ë™ì‘ ì›ë¦¬ê°€ ì´ ë¶€ë¶„ê³¼ ì—°ê´€ë¼ìˆì„ ê²ƒ ê°™ë‹¤ëŠ” ì¶”ì¸¡ì„ í•˜ê²Œ ë˜ì—ˆë‹¤.

ë˜í•œ `not-found.js` íŒŒì¼ì˜ ë™ì‘ê³¼ ìœ ì‚¬í•œ íŒŒì¼ì„ ë°œê²¬í•  ìˆ˜ ìˆì—ˆëŠ”ë°, íŒŒì¼ ì•ˆì—ëŠ” `NotFoundErrorBoundary`ë¼ëŠ” í´ë˜ìŠ¤ê°€ ì¡´ì¬í–ˆë‹¤. ê·¸ë¦¬ê³  **ErrorBoundary**ì™€ ë§ˆì°¬ê°€ì§€ë¡œ `getDerivedStateFromError` ë©”ì„œë“œê°€ ì¡´ì¬í–ˆê³  **404 ì—ëŸ¬ë¥¼ ê°ì§€ ë° ì²˜ë¦¬í•˜ëŠ” ë¡œì§ìœ¼ë¡œ êµ¬ì„±**ëœ ê²ƒ ê°™ë‹¤.

ì•„ì‰½ê²Œë„ ìœ„ì˜ ë‚´ìš©ì„ ì¦ëª…í•  ìˆ˜ ìˆëŠ” ì •í™•í•œ ë ˆí¼ëŸ°ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— **ì •í™•í•œ ì •ë³´ë¼ê³  ë‹¨ì–¸**í•  ìˆ˜ëŠ” ì—†ë‹¤.

<br />
<hr />

<center>

### React Query(v5) + Suspense + Error Boundaries ì‚¬ìš©í•˜ê¸°

</center>

<br />

**React Query**ë¥¼ ì‚¬ìš©í•´ **Error Boundaries** êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œëŠ” `throwOnError` ì˜µì…˜ì„ ì‚¬ìš©í•´ ì¤˜ì•¼ í•˜ëŠ”ë°, **Suspense**ë¥¼ ê°™ì´ ì‚¬ìš©í•  ê²½ìš° ì‚¬ë¼ì§„ `suspense` ì˜µì…˜ì´ ì•„ë‹Œ `throwOnError` ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ë”°ë¡œ ì¶”ê°€í•  ì˜µì…˜ ì—†ì´ **Suspenseì™€** **Error Boundaries** ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.

ë§Œì•½ `useQuery` í›…ì´ ì•„ë‹Œ `useSuspenseQuery` í›…ì„ ì‚¬ìš©í•  ê²½ìš° ì´ë¦„ì—ì„œ ë³¼ ìˆ˜ ìˆëŠ” ê²ƒì²˜ëŸ¼ `throwOnError` ì˜µì…˜ ì—†ì´ ìë™ìœ¼ë¡œ **Suspense** ì ìš©ë˜ê³ , **Error Boundaries** ë˜í•œ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.

<br />

|  useQuery hook   |  useInfiniteQuery hook   | throwOnError ì˜µì…˜ ì‚¬ìš© ì—¬ë¶€ |
| :--------------: | :----------------------: | :-------------------------: |
|     useQuery     |     useInfiniteQuery     |          ì‚¬ìš© í•„ìš”          |
| useSuspenseQuery | useSuspenseInfiniteQuery |              X              |
|                  |                          |                             |

<br />
<hr />

<center>

### ErrorBoundary ì½”ë“œ

</center>

```
'use client'

import { Component, ReactNode, ErrorInfo, ComponentType } from 'react'

interface ErrorBoundaryState {
  hasError: boolean
  error: Error | null
}

export interface FallbackProps {
  error: Error | null
  resetErrorBoundary: () => void
}

type ErrorBoundaryProps = {
  FallbackComponent: ComponentType<FallbackProps>
  onReset: () => void
  children: ReactNode
}

class ErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {
  constructor(props: ErrorBoundaryProps) {
    super(props)

    this.state = {
      hasError: false,
      error: null,
    }

    this.resetErrorBoundary = this.resetErrorBoundary.bind(this)
  }

  /** ì—ëŸ¬ ìƒíƒœ ë³€ê²½ */
  static getDerivedStateFromError(error: Error): ErrorBoundaryState {
    return { hasError: true, error }
  }

  componentDidCatch(error: Error, errorInfo: ErrorInfo): void {
    console.log({ error, errorInfo })
  }

  /** ì—ëŸ¬ ìƒíƒœ ê¸°ë³¸ ì´ˆê¸°í™” */
  resetErrorBoundary(): void {
    this.props.onReset()

    this.setState({
      hasError: false,
      error: null,
    })
  }

  render() {
    const { state, props } = this

    const { hasError, error } = state

    const { FallbackComponent, children } = props

    if (hasError && error) {
      return (
        <FallbackComponent
          error={error}
          resetErrorBoundary={this.resetErrorBoundary}
        />
      )
    }

    return children
  }
}

export default ErrorBoundary
```

<br />
<hr />

<center>

### QueryErrorResetBoundary ì»´í¬ë„ŒíŠ¸ ì ìš©í•˜ê¸°

</center>

<br />

ì ìš© ë°©ë²•ì€ ë§¤ìš° ê°„ë‹¨ì§€ë§Œ, ì£¼ì˜ ì‚¬í•­ì´ ëª‡ ê°€ì§€ ìˆë‹¤.

1. `useSuspenseQuery`ë¥¼ ì‚¬ìš©í•  ê²½ìš° **Suspense** ì»´í¬ë„ŒíŠ¸ë¥¼ ë¨¼ì € ì ìš©í•  ì»´í¬ë„ŒíŠ¸ ìƒìœ„ì— ë˜í•‘í•˜ê³  ì‚¬ìš©í•˜ê¸° (**ë¬´í•œ ë£¨í”„ ë°œìƒ ìœ„í—˜**) - [ì°¸ê³ ](https://mintmin-dev-world.vercel.app/blog/20240202)
2. **ErrorBoundary** ì»´í¬ë„ŒíŠ¸ì— `QueryErrorResetBoundary` ì»´í¬ë„ŒíŠ¸ì—ì„œ ì œê³µí•˜ëŠ” **ì¿¼ë¦¬ ì—ëŸ¬ ìƒíƒœ ì´ˆê¸°í™” ì—­í• **ì„ í•˜ëŠ” **ë§¤ê°œë³€ìˆ˜ì™€ fallbackì„ ì²˜ë¦¬í•˜ëŠ” ë¡œì§ì´ í•„ìš”**í•˜ë‹¤.

<br />

<center>

### ì ìš© ì½”ë“œ

</center>

```
return (
  <QueryErrorResetBoundary>
    {({ reset }) => (
      <ErrorBoundary onReset={reset} FallbackComponent={ErrorFullback}>
        <Suspense fallback={<Loading />}>
          <RankingList />
          <VoteList />
        </Suspense>
      </ErrorBoundary>
    )}
  </QueryErrorResetBoundary>
)
```

`QueryErrorResetBoundary` ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•´ ì •ìƒì ìœ¼ë¡œ ì½”ë“œë¥¼ êµ¬í˜„í–ˆë‹¤ê³  ìƒê°í–ˆëŠ”ë°, **ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤**. ì—ëŸ¬ì˜ ë‚´ìš©ì„ ìš”ì•½í•˜ë©´, **ì„œë²„ ì»´í¬ë„ŒíŠ¸ì—ì„œ QueryErrorResetBoundary ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤**ëŠ” ë‚´ìš©ì´ë‹¤.

`QueryErrorResetBoundary` ì»´í¬ë„ŒíŠ¸ëŠ” í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œë§Œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— ì–´ì°Œ ë³´ë©´ ë‹¹ì—°í•œ ì—ëŸ¬ ë°œìƒì´ì§€ë§Œ ëª…í™•í•œ í•´ê²° ë°©ì•ˆì„ ì°¾ì§€ ëª»í•´ í•œ ê±¸ìŒì”© ì§ì ‘ ê±¸ì–´ë³´ê¸°ë¡œ í–ˆë‹¤.

ì²« ì‹œë„ë¡œ **ì„œë²„ ì»´í¬ë„ŒíŠ¸ í•˜ìœ„ì— í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ë¥¼ ì¶”ê°€**í•´ ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ í–ˆìœ¼ë‚˜ **ë¶ˆí•„ìš”í•œ Dept**ê°€ ìƒê¸°ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤. ì„œë²„ ì»´í¬ë„ŒíŠ¸ëŠ” ë§ì€ ì¥ì ì´ ìˆì§€ë§Œ, ì—­ì‹œ ì‚¬ìš©í•¨ì— ìˆì–´ ê¹Œë‹¤ë¡œìš´ ë¶€ë¶„ì´ ìˆëŠ” ê²ƒ ê°™ë‹¤.

ê·¸ë ‡ê²Œ ê³ ë¯¼ì„ ì´ì–´ê°€ë˜ ì¤‘ **QueryErrorResetBoundary, ErrorBoundary, Suspenseë¥¼ í•˜ë‚˜ì˜ ê³µí†µ ì»´í¬ë„ŒíŠ¸ë¡œ ë§Œë“¤ê³  ì´ ì»´í¬ë„ŒíŠ¸ë¥¼ í•©ì„±(Composition) ë°©ì‹ìœ¼ë¡œ ì„œë²„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©**í•˜ëŠ” ë°©ë²•ì„ ê³ ì•ˆí•˜ê²Œ ë˜ì—ˆë‹¤.

<br />
<hr />

<center>

### ErrorHandlingWrapper ì»´í¬ë„ŒíŠ¸ ì½”ë“œ

</center>

`ErrorHandlingWrapper`ë¼ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ ë§Œë“¤ê³  **ì¬ì‚¬ìš©ì„±ì„ ê³ ë ¤í•´ ErrorBoundaryì™€ Suspense fallback ì»´í¬ë„ŒíŠ¸ëŠ” propsë¡œ ê´€ë¦¬**í–ˆë‹¤.

```
'use client'

import { QueryErrorResetBoundary } from '@tanstack/react-query'
import { ComponentType, ReactNode, Suspense } from 'react'
import ErrorBoundary, { FallbackProps } from '../errorBoundary'

interface PropsType {
  children: React.ReactNode
  fallbackComponent: ComponentType<FallbackProps>
  suspenseFallback: ReactNode
}

export default function ErrorHandlingWrapper({
  children,
  fallbackComponent: FallbackComponent,
  suspenseFallback: SuspenseFallback,
}: PropsType) {
  return (
    <QueryErrorResetBoundary>
      {({ reset }) => (
        <ErrorBoundary onReset={reset} FallbackComponent={FallbackComponent}>
          <Suspense fallback={SuspenseFallback}>{children}</Suspense>
        </ErrorBoundary>
      )}
    </QueryErrorResetBoundary>
  )
}

```

ê·¸ë¦¬ê³  `page.tsx(ì„œë²„ ì»´í¬ë„ŒíŠ¸)`ì—ì„œ `ErrorHandlingWrapper` ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ **ì„œë²„ ì»´í¬ë„ŒíŠ¸ì—ì„œë„ QueryErrorResetBoundary ì‚¬ìš©ì´ ê°€ëŠ¥**í•´ ì§„ë‹¤.

```
return(
  <ErrorHandlingWrapper
    fallbackComponent={ErrorFallback}
    suspenseFallback={<Loading />}
  >
    <RankingList />
    <VoteList />
  </ErrorHandlingWrapper>
)
```

<br />
<hr />

<center>

### í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¸íŒ…í•˜ê¸°

<br />

</center>

```
 const votePath = Math.random() < 0.5 ? 'votes' : 'vote'
```

<center>

#### ğŸ’¡ ëœë¤ìœ¼ë¡œ ìš”ì²­ ì‹œ api ê²½ë¡œë¥¼ ë³€ê²½í•˜ë„ë¡ votePathë¼ëŠ” ë³€ìˆ˜ë¥¼ ì¶”ê°€í•œë‹¤.

</center>

<br />

```
import { RankingInfo } from '@/app/_types/vote.type'
import { useSuspenseQuery } from '@tanstack/react-query'
import { voteKeys } from '.'

async function fetchVoteRanking(hobby: string): Promise<RankingInfo> {
  const votePath = Math.random() < 0.5 ? 'votes' : 'vote'

  const res = await fetch(
    `${process.env.NEXT_PUBLIC_BASE_URL}/api/${votePath}/ranking?hobby=${hobby}`,
    {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
      },
      cache: 'no-store',
    },
  )

  const data = await res.json()

  if (!res.ok) {
    throw new Error(data.message)
  }

  return data
}

export const useVoteRanking = (hobby: string) => {
  const { data: rankingList } = useSuspenseQuery({
    queryKey: voteKeys.voteRanking(hobby).queryKey,
    queryFn: () => fetchVoteRanking(hobby),
    staleTime: 1000 * 60,
  })

  return { rankingList }
}
```

ì˜ëª»ëœ API ê²½ë¡œ ì…ë ¥ìœ¼ë¡œ ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œ **ErrorFallback ì»´í¬ë„ŒíŠ¸ì— ë©”ì¸ ì´ë™, ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸° ë²„íŠ¼ì´ ì •ìƒì ìœ¼ë¡œ í™”ë©´ì— ë Œë”ë§** ë˜ê³  **ìƒˆë¡œê³ ì¹¨ë§Œ ë˜ë˜ ì´ì „ê³¼ ë‹¬ë¦¬ React Queryë¡œ ìºì‹œ ëœ ë°ì´í„°ê¹Œì§€ ì •ìƒì ìœ¼ë¡œ ì¬ì„¤ì •** í•˜ê²Œ ëœë‹¤.

<br />
<hr />

<center>

### ê²°ê³¼

![](https://velog.velcdn.com/images/mintmin0320/post/0f5fb512-768d-4c94-bedf-2f541cd9988b/image.gif)

</center>

<br />
<hr />

<center>

### ì„±ê³¼

</center>

1. **Error Boundaries**ë¥¼ ì ìš©í•¨ìœ¼ë¡œì¨ ì‚¬ìš©ìì—ê²Œ **ì—ëŸ¬ ë°œìƒ ìƒí™©ì„ ì¸ì§€**ì‹œí‚¤ê³  **í•´ê²° ë°©ì•ˆ**ì„ ì œì‹œí•´ **ì‚¬ìš©ì ê²½í—˜ í–¥ìƒ**
2. `isLoading`, `isError`ì™€ ê°™ì€ ì½”ë“œë¥¼ **Suspense**ì™€ **Error Boundaries**ë¥¼ ì‚¬ìš©í•´ ëŒ€ì²´í•¨ìœ¼ë¡œì¨ **Loading**, **Error** **ê´€ì‹¬ì‚¬ ë¶„ë¦¬**

<br />
<hr />

<center>

### ë§ˆì¹˜ë©°

</center>

ì´ë²ˆ ì‘ì—…ì—ì„œëŠ” **ê³µí†µë˜ëŠ” QueryErrorResetBoundary, Suspense, ErrorBoundary ì»´í¬ë„ŒíŠ¸ë¥¼ ì¬ì‚¬ìš©**í•˜ê¸° ìœ„í•´ ë§ì€ ê³ ë¯¼ì„ í–ˆì—ˆë‹¤. ì´ˆê¸°ì—ëŠ” í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ë¡œ ë¶„ë¦¬í•´ ë³´ê¸°ë„ í•˜ê³ , props ë° childrenì„ ì‚¬ìš©í•´ **ë‹¤ì–‘í•œ ë°©ë²•ì„ ì‹¤í–‰ ë° ë¶„ì„**í•´ ë³´ë©° ë‚˜ë¦„ ë§Œì¡±ìŠ¤ëŸ¬ìš´ ë°©ì‹ì„ ì°¾ì„ ìˆ˜ ìˆì—ˆë‹¤.

Nextë¡œ ê°œë°œì„ ì§„í–‰í•˜ë©° ì•„ì‰¬ìš´ ë¶€ë¶„ì´ ìˆë‹¤ë©´, **ì—­ì‹œ ê´€ë ¨ ë ˆí¼ëŸ°ìŠ¤ê°€ ë¶€ì¡±**í•˜ë‹¤ëŠ” ê²ƒì´ë‹¤. ì´ ë¶€ë¶„ ì™¸ì—ëŠ” **í”„ë ˆì„ì›Œí¬ê°€ ì œê³µí•˜ëŠ” í¸ë¦¬í•œ ê¸°ëŠ¥**ì— ë§¤ìš° ë§Œì¡±í•˜ë©° ì‚¬ìš©í•˜ê³  ìˆë‹¤.

ì´ë²ˆì— Next í”„ë¡œì íŠ¸ë¡œ Error Boundariesë¥¼ ì§ì ‘ êµ¬í˜„í•˜ë©° Reactì—ì„œ ì§„í–‰í–ˆë˜ ë°©ì‹ê³¼ëŠ” **ë‹¤ë¥¸ ë¬¸ì œë“¤**ì„ ë§ˆì£¼í•  ìˆ˜ ìˆì—ˆë‹¤. **ë‹¨ìˆœíˆ ë¬¸ì œë¥¼ í•´ê²°í•œ ê²ƒë„ ì¤‘ìš”í•˜ì§€ë§Œ, ë¬¸ì œ í•´ê²° ê³¼ì •ì—ì„œ ì–»ì€ ë‹¤ë¥¸ ì§€ì‹ë“¤ì´ ì•ìœ¼ë¡œë„ í° ë„ì›€ì´ ë  ê²ƒ ê°™ë‹¤.** ì•ìœ¼ë¡œë„ ìŠµë“í•œ ì§€ì‹ì„ ì˜ ì •ë¦¬í•´ì„œ ê¸°ë¡í•˜ë„ë¡ í•˜ì. ğŸ‘

<br />
<br />
<hr />

<center>

## Reference

</center>

- [QueryErrorResetBoundary](https://tanstack.com/query/latest/docs/framework/react/reference/QueryErrorResetBoundary)
- [error-handling](https://nextjs.org/docs/app/building-your-application/routing/error-handling)
- [React CleanCode #1, í•©ì„±ìœ¼ë¡œ ê´€ì‹¬ì‚¬ë¥¼ ë¶„ë¦¬í•˜ê¸°](https://happysisyphe.tistory.com/62)
